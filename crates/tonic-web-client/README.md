Taken from https://lib.rs/crates/tonic-web-wasm-client with minor tweaks and wasm-specific stuff removed.
